# Руководство по настройке Turso и деплою на Expo.dev

## Шаг 1: Создание базы данных Turso

1. **Установите Turso CLI** (если еще не установлен):
```bash
# Windows (PowerShell)
irm get.turso.tech/install.ps1 | iex

# macOS/Linux
curl -sSfL https://get.tur.so/install.sh | bash
```

2. **Войдите в аккаунт Turso**:
```bash
turso auth login
```

3. **Создайте новую базу данных**:
```bash
turso db create restaurant-app
```

4. **Получите URL базы данных**:
```bash
turso db show restaurant-app --url
```
Скопируйте URL (например: `libsql://restaurant-app-username.turso.io`)

5. **Создайте токен доступа**:
```bash
turso db tokens create restaurant-app
```
Скопируйте токен (длинная строка)

## Шаг 2: Настройка переменных окружения

1. **Откройте файл `.env`** в корне проекта

2. **Добавьте переменные Turso**:
```env
TURSO_DATABASE_URL=libsql://restaurant-app-username.turso.io
TURSO_AUTH_TOKEN=ваш_токен_здесь
```

## Шаг 3: Инициализация базы данных

1. **Создайте схему в базе данных**:
```bash
bun run db:push
```

2. **Заполните базу начальными данными**:
```bash
bun run db:seed
```

## Шаг 4: Тестирование локально

1. **Запустите приложение**:
```bash
bun start
```

2. **Проверьте, что данные загружаются из базы**:
   - Откройте приложение
   - Проверьте, что блюда отображаются
   - Попробуйте создать заказ

## Шаг 5: Деплой на Expo.dev

1. **Убедитесь, что переменные окружения настроены в Expo**:
```bash
# Установите переменные окружения для production
eas secret:create --scope project --name TURSO_DATABASE_URL --value "ваш_url"
eas secret:create --scope project --name TURSO_AUTH_TOKEN --value "ваш_токен"
```

2. **Соберите APK**:
```bash
eas build --platform android --profile preview
```

## Шаг 6: Проверка работы

После установки APK на устройство:

1. **Проверьте подключение к базе**:
   - Откройте приложение
   - Блюда должны загружаться с сервера
   - Создайте тестовый заказ

2. **Проверьте синхронизацию между устройствами**:
   - Откройте приложение на двух устройствах
   - Создайте заказ на одном устройстве
   - Заказ должен появиться на другом устройстве (после обновления)

## Важные команды

```bash
# Просмотр всех баз данных
turso db list

# Просмотр информации о базе
turso db show restaurant-app

# Подключение к базе через CLI
turso db shell restaurant-app

# Обновление схемы базы данных
bun run db:push

# Заполнение базы данными
bun run db:seed
```

## Устранение проблем

### Ошибка подключения к базе данных
- Проверьте, что `TURSO_DATABASE_URL` и `TURSO_AUTH_TOKEN` правильно установлены
- Убедитесь, что база данных создана и активна: `turso db list`

### Данные не синхронизируются
- Проверьте, что бэкенд запущен и доступен
- Проверьте логи в консоли на наличие ошибок
- Убедитесь, что приложение использует правильный URL бэкенда

### Заказы не приходят админу
- Убедитесь, что оба устройства подключены к интернету
- Проверьте, что используется одна и та же база данных
- Обновите список заказов вручную (потяните вниз)

## Дополнительная информация

- Документация Turso: https://docs.turso.tech/
- Документация Expo: https://docs.expo.dev/
- Документация tRPC: https://trpc.io/docs/
