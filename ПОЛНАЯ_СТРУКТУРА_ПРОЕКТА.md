# 📱 Полная структура проекта - Приложение для ресторана

## 🎯 Описание проекта
Мобильное приложение для ресторана с функциями:
- Просмотр меню и заказ блюд
- Корзина и оформление заказа
- Авторизация через SMS
- Админ-панель для управления
- Интеграция с Turso Database
- Поддержка веб и мобильных платформ

---

## 📁 Структура файлов

```
project/
├── api/
│   └── index.ts                    # Vercel API endpoint
├── app/
│   ├── (tabs)/
│   │   ├── _layout.tsx            # Tabs navigation
│   │   ├── index.tsx              # Redirect to home
│   │   ├── home.tsx               # Главная страница с меню
│   │   ├── cart.tsx               # Корзина
│   │   ├── orders.tsx             # Заказы
│   │   ├── profile.tsx            # Профиль пользователя
│   │   └── settings.tsx           # Настройки
│   ├── auth/
│   │   ├── phone.tsx              # Ввод телефона
│   │   └── verify.tsx             # Подтверждение кода
│   ├── _layout.tsx                # Root layout
│   ├── index.tsx                  # Entry point
│   ├── admin.tsx                  # Админ панель
│   ├── checkout.tsx               # Оформление заказа
│   └── +not-found.tsx             # 404 страница
├── backend/
│   ├── db/
│   │   ├── client.ts              # Database client
│   │   └── schema.ts              # Database schema
│   ├── trpc/
│   │   ├── routes/
│   │   │   ├── auth/
│   │   │   │   ├── login-admin.ts
│   │   │   │   ├── send-sms.ts
│   │   │   │   └── verify-sms.ts
│   │   │   ├── categories/
│   │   │   │   └── get-all.ts
│   │   │   ├── dishes/
│   │   │   │   ├── create.ts
│   │   │   │   ├── delete.ts
│   │   │   │   ├── get-all.ts
│   │   │   │   └── update.ts
│   │   │   ├── orders/
│   │   │   │   ├── create.ts
│   │   │   │   ├── get-all.ts
│   │   │   │   └── update-status.ts
│   │   │   ├── restaurant/
│   │   │   │   ├── get.ts
│   │   │   │   └── update.ts
│   │   │   └── example/
│   │   │       └── hi/
│   │   │           └── route.ts
│   │   ├── app-router.ts          # tRPC router
│   │   └── create-context.ts      # tRPC context
│   └── hono.ts                    # Hono server
├── constants/
│   ├── colors.ts                  # Color constants
│   └── dishes.ts                  # Mock dishes data
├── lib/
│   └── trpc.ts                    # tRPC client
├── store/
│   └── restaurant-store.ts        # Global state
├── types/
│   └── restaurant.ts              # TypeScript types
├── .env                           # Environment variables
├── app.json                       # Expo config
├── package.json                   # Dependencies
├── tsconfig.json                  # TypeScript config
├── drizzle.config.ts              # Drizzle ORM config
└── vercel.json                    # Vercel config
```

---

## 🔧 Ключевые файлы

### 1. `.env` - Переменные окружения

```env
# Backend API URL
EXPO_PUBLIC_RORK_API_BASE_URL=https://rork-project-review-and-feedback-pwy6lkx1a.vercel.app

# SMS.ru API Configuration
EXPO_PUBLIC_SMS_API_ID=457A5DBA-D814-BC10-DDD7-645DC659658E

# Turso Database Configuration
TURSO_DATABASE_URL=libsql://restaurant-app-never3d22.aws-eu-west-1.turso.io
TURSO_AUTH_TOKEN=eyJhbGciOiJFZERTQSIsInR5cCI6IkpXVCJ9.eyJhIjoicnciLCJpYXQiOjE3NTkyOTg2NjAsImlkIjoiNmFhZWM3NjQtYWI0MS00NTdlLTg3MjEtODY5ZjIyMDE5OTc5IiwicmlkIjoiMzc3MWNjMDAtNGNmMy00Y2FlLTk4ZjQtN2E1OWYxNTU4MGQ2In0.b2OyNKShbcaa7ae8LnhjHX0jSH0GFxk_J55isBqrQqG5rfAXrPBjOxmdAS5YKNzX511MA-OZdEqMzp-mC6f9Ag
```

### 2. `vercel.json` - Vercel конфигурация

```json
{
  "version": 2,
  "builds": [
    {
      "src": "package.json",
      "use": "@vercel/static-build",
      "config": {
        "distDir": "dist"
      }
    },
    {
      "src": "api/index.ts",
      "use": "@vercel/node"
    }
  ],
  "routes": [
    {
      "src": "/api/(.*)",
      "dest": "/api/index.ts"
    },
    {
      "src": "/_expo/static/.*",
      "headers": {
        "cache-control": "public, max-age=31536000, immutable"
      }
    },
    {
      "src": "/(.*)",
      "dest": "/index.html"
    }
  ]
}
```

### 3. `backend/db/schema.ts` - Схема базы данных

```typescript
import { sql } from 'drizzle-orm';
import { sqliteTable, text, integer, real } from 'drizzle-orm/sqlite-core';

export const users = sqliteTable('users', {
  id: text('id').primaryKey(),
  name: text('name').notNull(),
  email: text('email').notNull(),
  phone: text('phone'),
  birthday: text('birthday'),
  isAdmin: integer('is_admin', { mode: 'boolean' }).notNull().default(false),
  addresses: text('addresses'),
  createdAt: integer('created_at', { mode: 'timestamp' }).notNull().default(sql`(unixepoch())`),
});

export const orders = sqliteTable('orders', {
  id: text('id').primaryKey(),
  userId: text('user_id'),
  userName: text('user_name'),
  userPhone: text('user_phone'),
  items: text('items').notNull(),
  total: real('total').notNull(),
  utensils: integer('utensils', { mode: 'boolean' }).notNull().default(false),
  utensilsCount: integer('utensils_count').notNull().default(0),
  paymentMethod: text('payment_method').notNull(),
  deliveryType: text('delivery_type').notNull(),
  deliveryAddress: text('delivery_address'),
  deliveryTime: text('delivery_time'),
  comments: text('comments'),
  status: text('status').notNull().default('pending'),
  cancelReason: text('cancel_reason'),
  cancelledAt: integer('cancelled_at', { mode: 'timestamp' }),
  paymentStatus: text('payment_status'),
  paymentId: text('payment_id'),
  paymentUrl: text('payment_url'),
  createdAt: integer('created_at', { mode: 'timestamp' }).notNull().default(sql`(unixepoch())`),
});

// ... другие таблицы
```

---

## 🚀 Инструкция по запуску

### 1. Установка зависимостей

```bash
bun install
```

### 2. Настройка переменных окружения

Создайте файл `.env` и добавьте:

```env
EXPO_PUBLIC_RORK_API_BASE_URL=https://ваш-домен.vercel.app
TURSO_DATABASE_URL=libsql://ваша-база.turso.io
TURSO_AUTH_TOKEN=ваш_токен
EXPO_PUBLIC_SMS_API_ID=ваш_api_id
```

### 3. Настройка базы данных Turso

```bash
# Установите Turso CLI
curl -sSfL https://get.tur.so/install.sh | bash

# Войдите в аккаунт
turso auth login

# Создайте базу данных
turso db create restaurant-app

# Получите URL и токен
turso db show restaurant-app
turso db tokens create restaurant-app
```

### 4. Применение миграций

```bash
# Создайте миграции
bunx drizzle-kit generate:sqlite

# Примените миграции
bunx drizzle-kit push:sqlite
```

### 5. Запуск локально

```bash
# ��ля веб
bun run start-web

# Для мобильных устройств
bun run start
```

### 6. Деплой на Vercel

```bash
# Установите Vercel CLI
npm i -g vercel

# Деплой
vercel

# Добавьте переменные окружения в Vercel Dashboard:
# - TURSO_DATABASE_URL
# - TURSO_AUTH_TOKEN
# - EXPO_PUBLIC_SMS_API_ID
```

---

## 🔑 Важные моменты

### Переменные окружения в Vercel

Обязательно добавьте в Vercel Dashboard (Settings → Environment Variables):

1. `TURSO_DATABASE_URL` - URL базы данных
2. `TURSO_AUTH_TOKEN` - Токен доступа
3. `EXPO_PUBLIC_SMS_API_ID` - API ключ для SMS

### CORS настройки

В `backend/hono.ts` настроен CORS для всех доменов:

```typescript
app.use("*", cors({
  origin: '*',
  allowMethods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  allowHeaders: ['Content-Type', 'Authorization'],
  exposeHeaders: ['Content-Length'],
  maxAge: 600,
  credentials: true,
}));
```

### API Endpoints

- **API Base**: `https://ваш-домен.vercel.app/api`
- **tRPC**: `https://ваш-домен.vercel.app/api/trpc`
- **Health Check**: `https://ваш-домен.vercel.app/api`

---

## 🐛 Решение проблем

### Проблема: "Failed to fetch"

**Решение:**
1. Проверьте, что `EXPO_PUBLIC_RORK_API_BASE_URL` содержит полный URL с `https://`
2. Убедитесь, что API развернут на Vercel
3. Проверьте CORS настройки

### Проблема: "NOT NULL constraint failed"

**Решение:**
1. Убедитесь, что все обязательные поля заполнены при создании заказа
2. Проверьте схему базы данных
3. Проверьте, что `paymentMethod` и `deliveryType` передаются корректно

### Проблема: База данных не подключается

**Решение:**
1. Проверьте правильность `TURSO_DATABASE_URL` и `TURSO_AUTH_TOKEN`
2. Убедитесь, что переменные добавлены в Vercel
3. Проверьте логи в Vercel Dashboard

---

## 📊 Структура данных

### User
```typescript
{
  id: string;
  name: string;
  email: string;
  phone?: string;
  birthday?: string;
  isAdmin: boolean;
  addresses?: string[];
}
```

### Order
```typescript
{
  id: string;
  items: CartItem[];
  total: number;
  utensils: boolean;
  utensilsCount: number;
  paymentMethod: 'card' | 'sberpay' | 'cash' | 'sbp';
  deliveryType: 'pickup' | 'delivery';
  deliveryAddress?: string;
  deliveryTime?: string;
  comments: string;
  status: 'pending' | 'preparing' | 'ready' | 'delivered' | 'cancelled';
  createdAt: Date;
  userId?: string;
  userName?: string;
  userPhone?: string;
}
```

### Dish
```typescript
{
  id: string;
  name: string;
  description: string;
  price: number;
  image: string;
  category: string;
  available: boolean;
  weight?: string;
  ingredients?: string[];
}
```

---

## 🔐 Админ доступ

**Логин:** admin  
**Пароль:** 1234

---

## 📱 Функционал

### Для клиентов:
- ✅ Просмотр меню
- ✅ Добавление в корзину
- ✅ Оформление заказа
- ✅ Авторизация через SMS
- ✅ История заказов
- ✅ Управление адресами

### Для администраторов:
- ✅ Управление блюдами
- ✅ Управление категориями
- ✅ Управление заказами
- ✅ Настройки ресторана
- ✅ Просмотр всех заказов

---

## 🛠 Технологии

- **Frontend:** React Native, Expo
- **Backend:** Hono, tRPC
- **Database:** Turso (LibSQL)
- **ORM:** Drizzle
- **State Management:** Zustand, React Query
- **Deployment:** Vercel
- **SMS:** SMS.ru API

---

## 📝 Следующие шаги

1. ✅ Настроить переменные окружения
2. ✅ Развернуть на Vercel
3. ✅ Протестировать создание заказов
4. ⏳ Добавить обработку платежей
5. ⏳ Добавить push-уведомления
6. ⏳ Оптимизировать производительность

---

## 🆘 Поддержка

Если возникли проблемы:
1. Проверьте логи в Vercel Dashboard
2. Проверьте консоль браузера/приложения
3. Убедитесь, что все переменные окружения настроены
4. Проверьте подключение к базе данных

---

**Дата создания:** 2025-01-XX  
**Версия:** 1.0.0
